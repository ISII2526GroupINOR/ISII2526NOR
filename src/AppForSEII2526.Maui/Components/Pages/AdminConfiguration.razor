@page "/adminconfiguration"
@inject Services.LanguageServices LanguageServices
@inject Services.FontServices FontServices
@inject Services.ProfileImageServices ProfileImageServices
@inject ThemeService ThemeService
@using Resources.Languages

<div class="d-flex justify-content-center align-items-center">
    <div class="center">
        <img class="profile-image" src="@ProfileImageServices.GetImageSource()"/>
        <Button Color="ButtonColor.Primary" @onclick="SelectProfileImage">@AppResources.ChangeImageButton</Button>
        
        <div class="row" sytle="margin-top: 20px">
            <h4>@AppResources.TextOptionsSubTitle</h4>
            <label for="font">@AppResources.FontSelector</label>
            <select name="font" id="font" class="form-select configuration-select"
                    @bind="FontServices.CurrentFontClass" @bind:after="changeFont">
                <option value="font-open-sans" hidden="@notlatin" disabled="@notlatin">Open sans</option>
                <option value="font-roboto-light" hidden="@notlatin" disabled="@notlatin">Roboto Light</option>
                <option value="font-roboto-italic" hidden="@notlatin" disabled="@notlatin">Roboto Italic</option>
                <option value="font-roboto-condensed" hidden="@notlatin" disabled="@notlatin">Roboto Condensed</option>
                <option value="font-play-fair" hidden="@notlatin" disabled="@notlatin">Play fair</option>
                <option value="font-noto-sans-jp" hidden="@notjapanese" disabled="@notjapanese">Noto sans (jp)</option>
            </select>
        </div>

        <div class="row" style="margin-top: 20px">
            <label for="language">@AppResources.LanguageSelector</label>
            <select name="language" id="language" class="form-select configuration-select"
                    @bind="LanguageServices.CurrentLanguage" @bind:after="changeLanguage">
                <option value="es">Español</option>
                <option value="en">English</option>
                <option value="ja">日本語</option>
            </select>
        </div>

        <div class="row" style="margin-top: 20px">
            <h4>@AppResources.Widget</h4>
            <CheckboxInput Label="@AppResources.RestockWidgetOption" @bind-Value="wRestock"/>
            <CheckboxInput Label="@AppResources.NotificationWidgetOption" @bind-Value="wNotification"/>

        </div>

        <!-- Theme selector (simple widget para pruebas) -->
        <div class="row" style="margin-top: 20px">
            <label for="theme">Theme</label>
            <select id="theme" class="form-select configuration-select" @onchange="OnThemeChanged" value="@SelectedTheme">
                <option value="system">System (auto)</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
                <option value="high-contrast">High contrast</option>
            </select>
        </div>

         <div class="fixed-bottom bg-white py-2">
            <div class="d-flex justify-content-center gap-5">
                <div style="font-size: 36px">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" @onclick="GoHome" cursor="pointer" width="20px" height="20px">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
                    </svg>
                </div>
                <div style="font-size: 36px">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" width="20px" height="20px">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 21v-7.5a.75.75 0 0 1 .75-.75h3a.75.75 0 0 1 .75.75V21m-4.5 0H2.36m11.14 0H18m0 0h3.64m-1.39 0V9.349M3.75 21V9.349m0 0a3.001 3.001 0 0 0 3.75-.615A2.993 2.993 0 0 0 9.75 9.75c.896 0 1.7-.393 2.25-1.016a2.993 2.993 0 0 0 2.25 1.016c.896 0 1.7-.393 2.25-1.015a3.001 3.001 0 0 0 3.75.614m-16.5 0a3.004 3.004 0 0 1-.621-4.72l1.189-1.19A1.5 1.5 0 0 1 5.378 3h13.243a1.5 1.5 0 0 1 1.06.44l1.19 1.189a3 3 0 0 1-.621 4.72M6.75 18h3.75a.75.75 0 0 0 .75-.75V13.5a.75.75 0 0 0-.75-.75H6.75a.75.75 0 0 0-.75.75v3.75c0 .414.336.75.75.75Z" />
                    </svg>
                </div>
                <div style="font-size: 36px">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" @onclick="GoProfile" cursor="pointer" width="20px" height="20px">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
                    </svg>
                </div>
                <div style="font-size: 36px">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" width="20px" height="20px">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
                    </svg>
                </div>
                <div style="font-size: 36px">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" @onclick="Exit" cursor="pointer" width="20px" height="20px">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 9V5.25A2.25 2.25 0 0 1 10.5 3h6a2.25 2.25 0 0 1 2.25 2.25v13.5A2.25 2.25 0 0 1 16.5 21h-6a2.25 2.25 0 0 1-2.25-2.25V15m-3 0-3-3m0 0 3-3m-3 3H15" />
                    </svg>
                </div>
            </div>
        </div>
  </div>

</div>
@code {
    [Inject] NavigationManager Nav { get; set; }
    void GoProfile() => Nav.NavigateTo("/adminprofile");
    void GoHome() => Nav.NavigateTo("/adminhome");
    void Exit() => Nav.NavigateTo("/");
    bool notlatin => LanguageServices.CurrentLanguage != "es" && LanguageServices.CurrentLanguage != "en";
    bool notjapanese => LanguageServices.CurrentLanguage != "ja";
    private bool wRestock
    {
        get { return Preferences.Get("wRestock", true); }
        set { Preferences.Set("wRestock", !wRestock); StateHasChanged(); }
    }

    private bool wNotification
    {
        get { return Preferences.Get("wNotification", true); }
        set { Preferences.Set("wNotification", !wNotification); StateHasChanged(); }
    }


    public void changeLanguage()
    {
        LanguageServices.SetLanguage(LanguageServices.CurrentLanguage);
        if(LanguageServices.CurrentLanguage == "ja")
        {
            FontServices.SetFont("font-noto-sans-jp");
        }
        StateHasChanged();
    }

    public void changeFont()
    {
        FontServices.SetFont(FontServices.CurrentFontClass);
        StateHasChanged();
    }

    public async Task SelectProfileImage()
    {
        await ProfileImageServices.LoadImage();
        StateHasChanged();
    }

    // Theme change widget
    private string SelectedTheme { get; set; } = "system";

    protected override void OnInitialized()
    {
        // inicializa valor actual del tema desde el servicio
        SelectedTheme = ThemeService.CurrentTheme ?? "system";

        base.OnInitialized();
    }

    private async Task OnThemeChanged(ChangeEventArgs e)
    {
        var newTheme = e.Value?.ToString() ?? "system";
        SelectedTheme = newTheme;
        await ThemeService.ApplyThemeAsync(newTheme);
        StateHasChanged();
    }
}
